<h4 class="username mt-3">
    <span>Mail Setting</span>
</h4>

<hr>
<ul ngbNav #nav="ngbNav" [(activeId)]="active" class="nav-tabs">
    <li [ngbNavItem]="1">
        <a ngbNavLink>User mail settings</a>
        <ng-template ngbNavContent>
            <form [formGroup]="userEmailSettingForm" (ngSubmit)="onSaveSetting()" class="mt-3">
                <div class="row">
                    <div class="col">
                        <ng-container *ngIf="projectsList.length > 0">
                            <ng-template #mail let-r="result" let-t="term">
                                <ngb-highlight [result]="r.projectName" [term]="t"></ngb-highlight>
                            </ng-template>
                            <div class="form-group mb-0">
                                <label for="exampleInputEmail1">Select Project
                                    <i class="fa fa-spinner fa-spin ml-2" aria-hidden="true" *ngIf="loading"></i>
                                </label>
                                <input id="typeahead-basic" type="text" class="form-control"
                                    formControlName="projectName" [ngbTypeahead]="searchProject"
                                    typeahead-show-hint="true" placeholder="Select Project"
                                    (selectItem)="onChangeProject($event, 1)" [resultTemplate]="mail"
                                    [inputFormatter]="mailFormatter" #mailInstance="ngbTypeahead"
                                    (focus)="focus$.next($any($event).target.value) ;"
                                    (click)="click$.next($any($event).target.value); "
                                    (input)="getProjectName($event , 1);" />
                            </div>
                        </ng-container>
                    </div>
                </div>

                <div class="row">
                    <div class="col">
                        <table class="table mt-3 mb-5">
                            <thead>
                                <th class="cell-1">Developer</th>
                                <th class="cell-2">Sender Name</th>
                                <th class="cell-3">Receiver Name</th>
                                <th class="cell-4">To Emails</th>
                                <th class="cell-4">CC Emails</th>
                                <th class="cell-4">BCC Emails</th>
                                <th class="cell-8" *ngIf="empListControl.length > 1">Same for all</th>
                            </thead>
                            <tbody>
                                <ng-container *ngIf="empListControl.value.length === 0">

                                    <td colspan="7" class="table-title-td">
                                        <i class="fa fa-exclamation-circle" aria-hidden="true"></i>
                                        No data found.
                                    </td>

                                </ng-container>

                                <ng-container formArrayName="emailSettingsUpdateRequests"
                                    *ngFor="let emp of empListControl.value; let i = index ;trackBy:trackByIndex">

                                    <tr [formGroupName]="i">
                                        <td class="cell-1">
                                            <input type="text" class="form-control" formControlName="userName" readonly>
                                        </td>
                                        <td class="cell-1">
                                            <input type="text" class="form-control" formControlName="senderName">
                                        </td>
                                        <td class="cell-1">
                                            <input type="text" class="form-control" formControlName="receiverName">
                                        </td>
                                        <td class="cell-1">

                                            <tag-input formControlName='toEmails' [separatorKeyCodes]="[9, 13]"
                                                [theme]="'bootstrap3-info'" [clearOnBlur]="true" placeholder="+ Add"
                                                secondaryPlaceholder="+ Add" modelAsStrings="true"
                                                [errorMessages]="errorMessages" maxItems="3" [validators]="validators">
                                            </tag-input>

                                        </td>
                                        <td class="cell-1">
                                            <tag-input formControlName='ccEmails' [theme]="'bootstrap3-info'"
                                                [separatorKeyCodes]="[9, 13]" [clearOnBlur]="true" placeholder="+ Add"
                                                secondaryPlaceholder="+ Add" modelAsStrings="true"
                                                [errorMessages]="errorMessages" [validators]="validators"></tag-input>

                                        </td>
                                        <td class="cell-1">
                                            <tag-input formControlName='bccEmails' [theme]="'bootstrap3-info'"
                                                [separatorKeyCodes]="[9, 13]" [clearOnBlur]="true" placeholder="+ Add"
                                                secondaryPlaceholder="+ Add" modelAsStrings="true"
                                                [errorMessages]="errorMessages" [validators]="validators"></tag-input>

                                        </td>
                                        <td class="cell-1">
                                            <input type="checkbox" class=" same-for-all" formControlName="sameForAll"
                                                *ngIf="i === 0 && empListControl.length > 1"
                                                (change)="onSameForAll($event)">
                                        </td>
                                    </tr>
                                </ng-container>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="row" *ngIf="empListControl.value.length > 0">
                    <div class="col-12 mb-5">
                        <button type="submit" class="btn btn-primary"> Save Settings</button>
                        <div class="error-message mt-2">
                            <p *ngIf="backendError">
                                {{backendError}}
                            </p>
                        </div>
                    </div>
                </div>

            </form>
        </ng-template>
    </li>
    <li [ngbNavItem]="2">
        <a ngbNavLink>Mail server settings</a>
        <ng-template ngbNavContent>
            <form [formGroup]="projectEmailSettingForm" class="mt-3">
                <div class="row mb-2">
                    <div class="col">
                        <ng-container *ngIf="projectsList.length > 0">
                            <ng-template #project let-r="result" let-t="term">
                                <ngb-highlight [result]="r.projectName" [term]="t"></ngb-highlight>
                            </ng-template>
                            <div class="form-group mb-0">
                                <label for="exampleInputEmail1">Select Project
                                    <i class="fa fa-spinner fa-spin ml-2" aria-hidden="true" *ngIf="loading"></i>
                                </label>
                                <input id="typeahead-basic1" type="text" class="form-control"
                                    formControlName="projectName" [ngbTypeahead]="searchProject"
                                    typeahead-show-hint="true" placeholder="Select Project"
                                    (selectItem)="onChangeProject($event , 2)" [resultTemplate]="project"
                                    [inputFormatter]="projectFormatter" #projectInstance="ngbTypeahead"
                                    (focus)="focus$.next($any($event).target.value) ;"
                                    (click)="click$.next($any($event).target.value); "
                                    (input)="getProjectName($event , 2);" />
                            </div>
                        </ng-container>
                    </div>
                </div>

                <div class="row" *ngIf="projectForm['projectName'].value">
                    <div class="col box">
                        <div class="form-group">
                            <div>
                                <label class="mb-2 mt-2 mt-2"> Host</label>
                                <div class="input-group mb-2">
                                    <input type="text" class="form-control w-100" formControlName="emailHost"
                                        placeholder="Enter Host" (input)="changeControlValue();">
                                    <div *ngIf="isSaveServer" class="error-message">
                                        <small *ngIf="projectForm['emailHost'].errors?.required" class="error-message">
                                            Enter Host
                                        </small>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <label class="mb-2 mt-2"> Port</label>
                                <div class="input-group mb-2">
                                    <input type="text" class="form-control w-100" formControlName="emailPort"
                                        placeholder="Enter Port" (input)="changeControlValue();">
                                    <small *ngIf="projectForm['emailPort'].errors?.pattern" class="error-message">
                                        Enter valid port
                                    </small>
                                    <div *ngIf="isSaveServer" class="error-message">
                                        <small *ngIf="projectForm['emailPort'].errors?.required" class="error-message">
                                            Enter Port
                                        </small>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <label class="mb-2 mt-2"> Protocol</label>
                                <div class="input-group mb-2">
                                    <input type="text" class="form-control w-100" formControlName="emailProtocol"
                                        placeholder="Enter Protocol" (input)="changeControlValue();">
                                    <div *ngIf="isSaveServer" class="error-message">
                                        <small *ngIf="projectForm['emailProtocol'].errors?.required"
                                            class="error-message">
                                            Enter Protocol
                                        </small>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <label class="mb-2 mt-2"> User Email</label>
                                <div class="input-group mb-2">
                                    <input type="email" class="form-control w-100" formControlName="emailUser"
                                        placeholder="Enter Email" (input)="changeControlValue();">

                                    <small *ngIf="projectForm['emailUser'].errors?.pattern" class="error-message">
                                        Enter valid email
                                    </small>
                                    <div *ngIf="isSaveServer" class="error-message">
                                        <small *ngIf="projectForm['emailUser'].errors?.required" class="error-message">
                                            Enter Email
                                        </small>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <label class="mb-2 mt-2"> Password</label>
                                <div class="input-group mb-2">
                                    <input type="password" class="form-control w-100" formControlName="emailPswd"
                                        placeholder="Enter Password" (input)="changeControlValue();">
                                    <div *ngIf="isSaveServer" class="error-message">
                                        <small *ngIf="projectForm['emailPswd'].errors?.required" class="error-message">
                                            Enter Password
                                        </small>
                                    </div>
                                </div>
                            </div>

                            <div class="row mt-4">
                                <div class="col-12 mb-1">

                                    <button type="button" class="btn btn-warning mr-4 " (click)="saveServer(true)">
                                        <span class="text-white view-mail"> Test Server </span>
                                    </button>

                                    <button type="submit" class="btn btn-primary" (click)="saveServer(false)"
                                        [disabled]="(isSaveServerDisable) ? true : null">
                                        <span>Save Settings</span>
                                    </button>

                                    <div class="error-message mt-2">
                                        <p *ngIf="backendError">
                                            {{backendError}}
                                        </p>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </ng-template>
    </li>
</ul>

<div [ngbNavOutlet]="nav" class="mt-2"></div>